

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Using Foolscap for Serialization &mdash; Foolscap v0.6.1 documentation</title>
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.6.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Foolscap v0.6.1 documentation" href="index.html" />
    <link rel="next" title="The Banana Protocol" href="specifications/banana.html" />
    <link rel="prev" title="Foolscap Schemas" href="schema.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="specifications/banana.html" title="The Banana Protocol"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="schema.html" title="Foolscap Schemas"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Foolscap v0.6.1 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="using-foolscap-for-serialization">
<h1>Using Foolscap for Serialization<a class="headerlink" href="#using-foolscap-for-serialization" title="Permalink to this headline">¶</a></h1>
<p>The same code that Foolscap uses to transport object graphs from one
process to another (over a wire) can be used to transport those graphs from
one process to another (over time). This code serializes an object (and the
other objects it references) into a series of bytes: these bytes can then
either be written to a network socket, or written to a file.</p>
<p>The main difference between the two cases is the way that certain special
objects are represented (and whether they can be represented at all). Inert
data like strings, lists, and numbers are equally serializable.``foolscap.Copyable`` objects are also serializable. But``foolscap.Referenceable`` objects only make sense to serialize in
the context of a connection through which <tt class="docutils literal"><span class="pre">callRemote</span></tt> messages
can eventually be sent. So trying to serialize a <tt class="docutils literal"><span class="pre">Referenceable</span></tt>
when the results are going to be written to disk should cause an error.</p>
<p>The way that Foolscap enables the re-use of its serialization code is to
allow it to be called with a different &#8220;Root Slicer&#8221;. This root gets to
decide how all objects are serialized. The Root Slicer for a live Foolscap
connection knows that Referenceables can be serialized with a special marker
that tells the other end of the connection how to construct a corresponding``RemoteReference`` (one which will be able to send``callRemote`` s over the connection).</p>
<div class="section" id="serializing-to-bytes">
<h2>Serializing to Bytes<a class="headerlink" href="#serializing-to-bytes" title="Permalink to this headline">¶</a></h2>
<p>To use Foolscap to serialize an object graph to a big string, use``foolscap.serialize`` . Note that this returns a Deferred.:</p>
<p><tt class="docutils literal"><span class="pre">import</span> <span class="pre">foolscap</span>&nbsp; <span class="pre">obj</span> <span class="pre">=</span> <span class="pre">[&quot;look</span> <span class="pre">at</span> <span class="pre">the</span> <span class="pre">pretty</span> <span class="pre">graph&quot;,</span> <span class="pre">3,</span> <span class="pre">True]</span> <span class="pre">obj.append(obj)</span> <span class="pre">#</span> <span class="pre">and</span> <span class="pre">look</span> <span class="pre">at</span> <span class="pre">the</span> <span class="pre">pretty</span> <span class="pre">cycle</span>&nbsp; <span class="pre">d</span> <span class="pre">=</span> <span class="pre">foolscap.serialize(obj)</span> <span class="pre">d.addCallback(lambda</span> <span class="pre">data:</span> <span class="pre">foolscap.unserialize(data))</span> <span class="pre">def</span> <span class="pre">_check(obj2):</span> <span class="pre">assert</span> <span class="pre">obj2[1]</span> <span class="pre">==</span> <span class="pre">&quot;3&quot;</span> <span class="pre">assert</span> <span class="pre">obj2[3]</span> <span class="pre">is</span> <span class="pre">obj2</span> <span class="pre">d.addCallback(_check)</span></tt></p>
<p>This form of serialization has the following restrictions:</p>
<ul class="simple">
<li>it can serialize any inert Python type</li>
<li>it can serialize <tt class="docutils literal"><span class="pre">foolscap.Copyable</span></tt> instances, and any
other instance that has an ISlicer or ICopyable adapter registered for
it</li>
<li>it cannot serialize Referenceables</li>
<li>it cannot serialize non-Copyable instances</li>
</ul>
<p>These restrictions mean that <tt class="docutils literal"><span class="pre">foolscap.serialize</span></tt> cannot
serialize everything that Python&#8217;s stdlib <tt class="docutils literal"><span class="pre">pickle</span></tt> module can
handle. However, it is safer (since <tt class="docutils literal"><span class="pre">foolscap.unserialize</span></tt> will
never import or execute arbitrary code like <tt class="docutils literal"><span class="pre">pickle.load</span></tt> will
do), and more extensible (since ISlicer/ICopyable adapters can be registered
for third-party classes).</p>
</div>
<div class="section" id="including-referenceables">
<h2>Including Referenceables<a class="headerlink" href="#including-referenceables" title="Permalink to this headline">¶</a></h2>
<p>To include Referenceables in the serialized data, you must use a Tub to do
the serialization, and the process returns a Deferred rather than running
synchronously:</p>
<p><tt class="docutils literal"><span class="pre">r</span> <span class="pre">=</span> <span class="pre">Referenceable()</span> <span class="pre">obj</span> <span class="pre">=</span> <span class="pre">[&quot;look</span> <span class="pre">at</span> <span class="pre">the</span> <span class="pre">pretty</span> <span class="pre">graph&quot;,</span> <span class="pre">3,</span> <span class="pre">r]</span>&nbsp; <span class="pre">d</span> <span class="pre">=</span> <span class="pre">tub1.serialize(obj)</span> <span class="pre">def</span> <span class="pre">_done(data):</span> <span class="pre">return</span> <span class="pre">tub2.unserialize(data)</span> <span class="pre">d.addCallback(_done)</span> <span class="pre">def</span> <span class="pre">_check(obj2):</span> <span class="pre">assert</span> <span class="pre">obj2[1]</span> <span class="pre">==</span> <span class="pre">&quot;3&quot;</span> <span class="pre">assert</span> <span class="pre">isinstance(obj2[2],</span> <span class="pre">RemoteReference)</span> <span class="pre">d.addCallback(_check)</span></tt></p>
<p>For this to work, the first Tub must have a location set on it, so that
you could do <tt class="docutils literal"><span class="pre">registerReference</span></tt> . The first Tub will serialize the
Referenceable with a special marker that the second Tub will be able to use
to establish a connection to the original object. This will only succeed if
the original Tub is still running and still knows about the Referenceable:
think of the embedded marker as a weakref.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Using Foolscap for Serialization</a><ul>
<li><a class="reference internal" href="#serializing-to-bytes">Serializing to Bytes</a></li>
<li><a class="reference internal" href="#including-referenceables">Including Referenceables</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="schema.html"
                        title="previous chapter">Foolscap Schemas</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="specifications/banana.html"
                        title="next chapter">The Banana Protocol</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/serializing.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="specifications/banana.html" title="The Banana Protocol"
             >next</a> |</li>
        <li class="right" >
          <a href="schema.html" title="Foolscap Schemas"
             >previous</a> |</li>
        <li><a href="index.html">Foolscap v0.6.1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011, Brian Warner.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.7.
    </div>
  </body>
</html>